---
title: "Event Types in Svelte and TypeScript"
emoji: "🎫"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ['svelte', 'typescript']
published: true
---

::: message
この記事は[Event Types in React and TypeScript]( https://www.totaltypescript.com/event-types-in-react-and-typescript )のSvelte版です。
英語版は気が向いたら書きます。
:::

::: message alert
この記事ではHTML DOMに関する型についてのみ触れます。
Svelte Componentの型の扱いについては以下のドキュメントを参照してください。
https://svelte.dev/docs/svelte#types-componentevents
:::

# The Problem

SvelteでTypeScriptを使っていると、しばしばこの種のエラーに遭遇することがあるでしょう。

```html
<script lang="ts">
    // @errors: 7006
    const onChange = (e) => {};
</script>

<input on:change={onChange} />
```

`onChange`関数の引数である`e`にどのような型を与えるべきかは必ずしも明確ではありません。
DOMごとにイベントには異なる型が与えられているためです。

幸い、いくつか解決策があります。

# Solution 1: 仮の関数を渡し、ホバーして型をコピーする

最初の解決策は、`on:change`に仮の関数を渡して、その関数にマウスをホバーさせることです。

![on:change hover](/images/380a0e4953bcaa/0.png)

何やら複雑な型がありますが、これをコピーして`onChange`関数の型として使うことができます。

```html
<script lang="ts">
  const onChange = (e: Event & {
    currentTarget: EventTarget & HTMLInputElement;
  }) => {};
</script>

<input on:change={onChange} />
```

# Solution 2: `SvelteHTMLElements`から型を取得する

https://svelte.jp/docs/typescript#enhancing-built-in-dom-types

こちらにHTML DOMの型に関する記述があります。
これによれば、`SvelteHTMLElements`からDOMの属性の種類とそれぞれの属性が取るべき関数の型を取得することができます。

```html
<script lang="ts">
  import type { SvelteHTMLElements  } from 'svelte/elements';

  type InputOnChangeEvent = SvelteHTMLElements['input']['on:change']
  const onChange: NonNullable<InputOnChangeEvent> = (e) => {} 
</script>

<input on:change={onChange} />
```

これにより、`onChange`の引数`e`の型を取得できます。

# Solution 3: `SvelteHTMLElementEvent`関数を使う

Solution 2のやり方はうまく行くのですが、毎回`SvelteHTMLElements`から型情報を取得するのは面倒です。
そのため、`SvelteHTMLElementEvent`という型を定義しておくと便利です。

```ts
import type { SvelteHTMLElements, EventHandler } from 'svelte/elements';

type Nullish<T> = T | null | undefined;

type GetEventHandlers<T extends keyof SvelteHTMLElements> = Extract<
	keyof SvelteHTMLElements[T],
	`on:${string}`
>;

export type SvelteHTMLElementEvent<
	TElement extends keyof SvelteHTMLElements,
	THandler extends GetEventHandlers<TElement>
> = SvelteHTMLElements[TElement][THandler] extends Nullish<EventHandler<infer TEvent, infer _>>
	? TEvent
	: never;
```

これを使うと、`onChange`の型を以下のように取得できます。

```html
<script lang="ts">
  import type { SvelteHTMLElementEvent } from 'svelte-html-event';

  const onChange = (e: SvelteHTMLElementEvent<'input', 'on:change'>) => {}
</script>

<input on:change={onChange} />
```

こちらはライブラリ化してnpmに公開しているので、
```sh
bun install svelte-html-event
```
でインストールできます。

https://github.com/ryoppippi/svelte-html-event

# まとめ
すでに自分の関わっているプロジェクトでは、Solution 3を使っています。
皆さんも是非お試しください〜
